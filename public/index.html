<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Video Chat</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Floating Particles Background -->
    <div class="particles-container">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>Random Video Chat</h1>
            <p>Connect with Strangers instantly</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Profile Setup Screen -->
            <div id="profile-screen" class="screen active">
                <div class="profile-card">
                    <h2>Welcome! Let's Get Started</h2>
                    <p>Please provide some information to personalize your experience</p>
                    
                    <form id="profile-form" class="profile-form">
                        <div class="form-group">
                            <label for="user-name">Your Name:</label>
                            <input type="text" id="user-name" name="name" required placeholder="Enter your name">
                        </div>
                        
                        <div class="form-group">
                            <label for="user-gender">Gender:</label>
                            <select id="user-gender" name="gender" required>
                                <option value="">Select gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                                <option value="prefer-not-to-say">Prefer not to say</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="gender-preference">Preferred Gender to Match With:</label>
                            <select id="gender-preference" name="genderPreference" required>
                                <option value="">Select preference</option>
                                <option value="any">Any Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                            <small>üí° We'll try to match you with your preferred gender when possible</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="user-country">Your Country:</label>
                            <select id="user-country" name="country" required>
                                <option value="">Select your country</option>
                                <option value="us">United States</option>
                                <option value="gb">United Kingdom</option>
                                <option value="ca">Canada</option>
                                <option value="au">Australia</option>
                                <option value="de">Germany</option>
                                <option value="fr">France</option>
                                <option value="in">India</option>
                                <option value="jp">Japan</option>
                                <option value="br">Brazil</option>
                                <option value="mx">Mexico</option>
                                <option value="ru">Russia</option>
                                <option value="cn">China</option>
                                <option value="kr">South Korea</option>
                                <option value="it">Italy</option>
                                <option value="es">Spain</option>
                                <option value="nl">Netherlands</option>
                                <option value="se">Sweden</option>
                                <option value="no">Norway</option>
                                <option value="dk">Denmark</option>
                                <option value="fi">Finland</option>
                                <option value="ch">Switzerland</option>
                                <option value="at">Austria</option>
                                <option value="be">Belgium</option>
                                <option value="pt">Portugal</option>
                                <option value="gr">Greece</option>
                                <option value="pl">Poland</option>
                                <option value="cz">Czech Republic</option>
                                <option value="hu">Hungary</option>
                                <option value="ro">Romania</option>
                                <option value="bg">Bulgaria</option>
                                <option value="hr">Croatia</option>
                                <option value="si">Slovenia</option>
                                <option value="sk">Slovakia</option>
                                <option value="ee">Estonia</option>
                                <option value="lv">Latvia</option>
                                <option value="lt">Lithuania</option>
                                <option value="ie">Ireland</option>
                                <option value="is">Iceland</option>
                                <option value="mt">Malta</option>
                                <option value="cy">Cyprus</option>
                                <option value="lu">Luxembourg</option>
                                <option value="mc">Monaco</option>
                                <option value="li">Liechtenstein</option>
                                <option value="sm">San Marino</option>
                                <option value="va">Vatican City</option>
                                <option value="ad">Andorra</option>
                                <option value="other">Other</option>
                            </select>
                            <div id="country-detected" class="country-detected" style="display: none;">
                                <small>üåç Country detected from your IP: <span id="detected-country">Unknown</span></small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="preferred-countries">Preferred Countries to Match With:</label>
                            <select id="preferred-countries" name="preferredCountries" multiple>
                                <option value="any">Any Country</option>
                                <option value="us">United States</option>
                                <option value="gb">United Kingdom</option>
                                <option value="ca">Canada</option>
                                <option value="au">Australia</option>
                                <option value="de">Germany</option>
                                <option value="fr">France</option>
                                <option value="in">India</option>
                                <option value="jp">Japan</option>
                                <option value="br">Brazil</option>
                                <option value="mx">Mexico</option>
                                <option value="ru">Russia</option>
                                <option value="cn">China</option>
                                <option value="kr">South Korea</option>
                                <option value="it">Italy</option>
                                <option value="es">Spain</option>
                                <option value="nl">Netherlands</option>
                                <option value="se">Sweden</option>
                                <option value="no">Norway</option>
                                <option value="dk">Denmark</option>
                                <option value="fi">Finland</option>
                                <option value="ch">Switzerland</option>
                                <option value="at">Austria</option>
                                <option value="be">Belgium</option>
                                <option value="pt">Portugal</option>
                                <option value="gr">Greece</option>
                                <option value="pl">Poland</option>
                                <option value="cz">Czech Republic</option>
                                <option value="hu">Hungary</option>
                                <option value="ro">Romania</option>
                                <option value="bg">Bulgaria</option>
                                <option value="hr">Croatia</option>
                                <option value="si">Slovenia</option>
                                <option value="sk">Slovakia</option>
                                <option value="ee">Estonia</option>
                                <option value="lv">Latvia</option>
                                <option value="lt">Lithuania</option>
                                <option value="ie">Ireland</option>
                                <option value="is">Iceland</option>
                                <option value="mt">Malta</option>
                                <option value="cy">Cyprus</option>
                                <option value="lu">Luxembourg</option>
                                <option value="mc">Monaco</option>
                                <option value="li">Liechtenstein</option>
                                <option value="sm">San Marino</option>
                                <option value="va">Vatican City</option>
                                <option value="ad">Andorra</option>
                            </select>
                            <small>Hold Ctrl/Cmd to select multiple countries</small>
                        </div>
                        
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="ip-permission" name="ipPermission" required>
                                <span class="checkmark"></span>
                                I agree to share my IP address for country-based matching
                            </label>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">
                            <span>Continue to Chat</span>
                            <div class="btn-shine"></div>
                        </button>
                    </form>
                </div>
            </div>

            <!-- Start Screen -->
            <div id="start-screen" class="screen">
                <div class="welcome-card">
                    <h2>Welcome, <span id="user-display-name">User</span>!</h2>
                    <p>Click the button below to start chatting with a random person</p>
                    
                    <div class="country-filter">
                        <label for="country-filter">Filter by Country:</label>
                        <select id="country-filter">
                            <option value="any">Any Country</option>
                            <option value="us">United States</option>
                            <option value="gb">United Kingdom</option>
                            <option value="ca">Canada</option>
                            <option value="au">Australia</option>
                            <option value="de">Germany</option>
                            <option value="fr">France</option>
                            <option value="in">India</option>
                            <option value="jp">Japan</option>
                            <option value="br">Brazil</option>
                            <option value="mx">Mexico</option>
                            <option value="ru">Russia</option>
                            <option value="cn">China</option>
                            <option value="kr">South Korea</option>
                            <option value="it">Italy</option>
                            <option value="es">Spain</option>
                            <option value="nl">Netherlands</option>
                            <option value="se">Sweden</option>
                            <option value="no">Norway</option>
                            <option value="dk">Denmark</option>
                            <option value="fi">Finland</option>
                            <option value="ch">Switzerland</option>
                            <option value="at">Austria</option>
                            <option value="be">Belgium</option>
                            <option value="pt">Portugal</option>
                            <option value="gr">Greece</option>
                            <option value="pl">Poland</option>
                            <option value="cz">Czech Republic</option>
                            <option value="hu">Hungary</option>
                            <option value="ro">Romania</option>
                            <option value="bg">Bulgaria</option>
                            <option value="hr">Croatia</option>
                            <option value="si">Slovenia</option>
                            <option value="sk">Slovakia</option>
                            <option value="ee">Estonia</option>
                            <option value="lv">Latvia</option>
                            <option value="lt">Lithuania</option>
                            <option value="ie">Ireland</option>
                            <option value="is">Iceland</option>
                            <option value="mt">Malta</option>
                            <option value="cy">Cyprus</option>
                            <option value="lu">Luxembourg</option>
                            <option value="mc">Monaco</option>
                            <option value="li">Liechtenstein</option>
                            <option value="sm">San Marino</option>
                            <option value="va">Vatican City</option>
                            <option value="ad">Andorra</option>
                        </select>
                    </div>
                    
                    <button id="start-chat-btn" class="btn btn-primary">
                        <span>Start Video Chat</span>
                        <div class="btn-shine"></div>
                    </button>
                    
                    <button id="edit-profile-btn" class="btn btn-secondary">
                        Edit Profile
                    </button>
                </div>
            </div>

            <!-- Waiting Screen -->
            <div id="waiting-screen" class="screen">
                <div class="waiting-card">
                    <div class="spinner"></div>
                    <h2>Looking for someone to chat with...</h2>
                    <p>Please wait while we find you a chat partner</p>
                    <button id="cancel-waiting-btn" class="btn btn-secondary">Cancel</button>
                    <!-- <button id="test-match-btn" class="btn btn-primary" style="margin-top: 10px; background-color: #ff6b6b;">Test Match (Debug)</button> -->
                </div>
            </div>

            <!-- Video Chat Screen -->
            <div id="chat-screen" class="screen">
                <div class="video-controls-wrapper">
                    <div class="video-area">
                        <div class="video-box remote">
                            <video id="remote-video" autoplay playsinline></video>
                            <div class="video-label">Partner</div>
                            <div id="partner-video-status" class="partner-status video-status hidden">
                                <span>Video Off</span>
                            </div>
                            <div id="partner-audio-status" class="partner-status audio-status hidden">
                                <span>Muted</span>
                            </div>
                            <!-- Looking for partner overlay -->
                            <div id="looking-for-partner" class="looking-for-partner hidden">
                                <div class="looking-spinner"></div>
                                <p>Looking for a new partner...</p>
                            </div>
                        </div>
                        <div class="video-box local">
                            <video id="local-video" autoplay playsinline muted></video>
                            <div class="video-label">You</div>
                        </div>
                    </div>
                    <!-- Controls Bar (now always below video area) -->
                    <div class="controls-bar">
                        <button id="toggle-video-btn" class="control-btn video-on" title="Toggle Video">
                            <!-- Material Icon: Videocam (on) -->
                            <svg class="icon-svg icon-video-on" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 10.5V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3.5l4 4v-11l-4 4z"/></svg>
                            <!-- Material Icon: Videocam Off (off) -->
                            <svg class="icon-svg icon-video-off" style="display:none;" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 10.5V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2v-3.5l4 4v-11l-4 4z"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                        <button id="toggle-audio-btn" class="control-btn audio-on" title="Toggle Audio">
                            <!-- Material Icon: Mic (on) -->
                            <svg class="icon-svg icon-audio-on" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="2" width="6" height="12" rx="3"/><path d="M5 10v2a7 7 0 0 0 14 0v-2"/></svg>
                            <!-- Material Icon: Mic Off (off) -->
                            <svg class="icon-svg icon-audio-off" style="display:none;" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="2" width="6" height="12" rx="3"/><path d="M5 10v2a7 7 0 0 0 14 0v-2"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                        <button id="next-chat-btn" class="control-btn" title="Next Chat">
                            <!-- Material Icon: Skip Next -->
                            <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><polygon points="6 18 14.5 12 6 6 6 18"/><rect x="16" y="6" width="2" height="12" rx="1"/></svg>
                        </button>
<button id="end-chat-btn" class="control-btn end-call" title="End Chat">
    <!-- Material Icon: Call End (curved hangup style) -->
    <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="currentColor">
        <path d="M21 15.46c-1.12 0-2.24-.11-3.32-.32-.3-.06-.62 0-.87.18l-2.54 1.91a16.88 16.88 0 0 1-4.54 0l-2.54-1.91a1.01 1.01 0 0 0-.87-.18A16.9 16.9 0 0 1 3 15.46a1 1 0 0 0-1 1.05v2.99c0 .6.52 1.08 1.11.99 1.77-.28 3.48-.78 5.09-1.49l1.87 1.41c1.2.9 2.79.9 3.99 0l1.87-1.41c1.61.71 3.32 1.21 5.09 1.49a1 1 0 0 0 1.11-.99v-2.99a1 1 0 0 0-1-1.05z"/>
    </svg>
</button>

                        <button id="toggle-chat-btn" class="control-btn" title="Toggle Chat">
                            <!-- Material Icon: Chat Bubble -->
                            <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                        </button>
                        <button id="debug-media-btn" class="control-btn" title="Debug Media">
                            <!-- Material Icon: Bug Report -->
                            <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" height="32" viewBox="0 0 24 24" width="32" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M19 7l-1.5 1.5M5 7l1.5 1.5M12 8v4M12 16h.01"/></svg>
                        </button>
                    </div>
                </div>
                <!-- Chat Panel (sibling, not inside video area) -->
                <div id="chat-panel" class="chat-panel">
                    <div class="chat-header">
                        <h3>Chat</h3>
                        <div class="chat-header-controls">
                            <button id="reset-chat-position-btn" class="reset-position-btn" title="Reset Position">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                                    <path d="M21 3v5h-5"/>
                                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                                    <path d="M3 21v-5h5"/>
                                </svg>
                            </button>
                            <button id="close-chat-btn" class="close-btn">√ó</button>
                        </div>
                    </div>
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-input-container">
                        <input type="text" id="chat-input" placeholder="Type a message..." />
                        <button id="send-message-btn">Send</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <div id="status-bar" class="status-bar">
            <span id="status-text">Ready to connect</span>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Test Socket.io connection
        if (typeof io === 'undefined') {
            console.error('Socket.io not loaded from CDN, trying fallback...');
            // Fallback to CDN
            const script = document.createElement('script');
            script.src = 'https://cdn.socket.io/4.8.1/socket.io.min.js';
            script.onload = function() {
                console.log('Socket.io loaded from CDN');
                // Initialize the app after Socket.io loads
                if (window.initVideoChat) {
                    window.initVideoChat();
                }
            };
            script.onerror = function() {
                console.error('Failed to load Socket.io from CDN');
                alert('Failed to load Socket.io library. Please check your internet connection.');
            };
            document.head.appendChild(script);
        } else {
            console.log('Socket.io loaded successfully');
        }
    </script>
    <script src="script.js"></script>
</body>
</html>
